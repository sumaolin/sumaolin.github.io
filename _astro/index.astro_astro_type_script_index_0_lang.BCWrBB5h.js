import{c as e,g as v,F as w,a as k}from"./data.BSYly2fy.js";import{a as b,u as Y}from"./Dialog.B8Z48HFO.js";import{g as D,l as T,a as I}from"./auth.uhWc7hRC.js";import{d as c,r as M}from"./relativeTime.i3NL2rpW.js";import{g as y}from"./_commonjsHelpers.Cpj98o6Y.js";import"./storage.1FXeSNfh.js";var u={exports:{}},C=u.exports,g;function $(){return g||(g=1,(function(a,r){(function(s,t){a.exports=t()})(C,(function(){return function(s,t,l){t.prototype.isToday=function(){var o="YYYY-MM-DD",n=l();return this.format(o)===n.format(o)}}}))})(u)),u.exports}var R=$();const j=y(R);var p={exports:{}},q=p.exports,x;function E(){return x||(x=1,(function(a,r){(function(s,t){a.exports=t()})(q,(function(){return function(s,t,l){t.prototype.isYesterday=function(){var o="YYYY-MM-DD",n=l().subtract(1,"day");return this.format(o)===n.format(o)}}}))})(p)),p.exports}var L=E();const B=y(L);c.extend(M);c.extend(j);c.extend(B);function A(a){const r=c(a),s=c();if(r.isToday())return"Today";if(r.isYesterday())return"Yesterday";const t=s.diff(r,"day");return t<7?`${t} Days ago`:s.year()===r.year()?r.format("MM/DD"):r.format("YYYY/MM/DD")}const F=()=>{const r=b(()=>{const[l,o]=Y({disabled:!0,"data-loading":!1}),n=k(),f=()=>{o({disabled:!n.current?.value.length})},d=async()=>{const h=n.current?.value;if(h){o({"data-loading":!0});try{await T(h),location.reload()}catch(m){alert(m.message)}finally{o({"data-loading":!1})}}},i=!!config.github.logInUrl;return e("div",{class:cn("flex flex-col p-4")},e("input",{type:"radio",name:"tabset",id:"tab1",class:"hidden peer/direct",checked:!i}),e("input",{type:"radio",name:"tabset",id:"tab2",class:"hidden peer/app",checked:i}),e("div",{class:cn("flex gap-4 justify-center pb-4",!i&&"hidden!")},e("label",{htmlFor:"tab1",class:"cursor-pointer peer-checked/direct:border-b-2 peer-checked/direct:border-red-500"},"Direct"),e("label",{htmlFor:"tab2",class:"cursor-pointer peer-checked/app:border-b-2 peer-checked/app:border-red-500"},"App")),e("div",{class:"flex"},e("div",{class:"hidden peer-checked/direct:block w-full"},e("div",{class:"flex flex-col gap-4"},e("div",null,"Enter your github token:"),e("p",{class:"text-red text-sm font-bold"},"Don't enter your Github token if you are not owner of this site !!!"),e("a",{href:"https://github.com/settings/personal-access-tokens/new",target:"_blank",class:"text-xs underline text-blue"},"learn here"),e("input",{ref:n,type:"text",placeholder:"paste your token here",class:"rounded border dark:border-gray px-2 py-1 text-sm bg-transparent",onInput:f,onChange:d}),e("button",{class:"buttoned bg-blue",ref:l,onClick:d},"confirm"))),e("div",{class:"hidden peer-checked/app:block w-full h-full"},e("div",{class:"w-full h-full flex justify-center p-2"},e("a",{href:config.github.logInUrl,class:"buttoned bg-[#202328] text-white text-sm"},e("div",{class:"i-ri:github-fill"})," Login with Github")))))}),s=()=>{r.show()};return e("button",{class:"text-sm",onClick:s,title:"login"},e("div",{class:"i-ri:triangle-line"}))},P=a=>{const r=()=>{I(),location.reload()},t=b(()=>e("div",{class:"w-full flex-1 flex flex-col gap-2 p-4 justify-between"},e("div",null,e("div",{class:"text-lg"},"Are you sure to log out?"),e("div",{class:"text-gray text-sm"},"Token will be clear, make sure you saved it elsewhere")),e("button",{class:"buttoned bg-red",onClick:r},"log out"))),l=()=>{t.show()},o=!!a.permissions?.push,n=location.pathname==="/",f=n||/^\/\d+$/.test(location.pathname),d=location.pathname.startsWith("/post"),i=location.pathname.replace("/post/","");return o&&n&&G(),e("div",{class:"flex gap-2"},o&&f&&e("a",{href:"/edit?new",class:"text-button","aria-label":"create new post"},e("div",{class:"i-ri:add-large-line"})),o&&d&&e("a",{href:`/edit?path=${i}`,class:"text-button","aria-label":"edit current post"},e("div",{class:"i-ri:quill-pen-fill"})),e("div",{class:"w-6 h-6 rounded-full cursor-pointer",onClick:l},e("img",{src:a.avatar,alt:"",class:"rounded-full"})))},S=()=>(()=>{const r=D();return r?P(r):F()})(),U=a=>{const r=document.querySelector(a);r&&r.appendChild(S())},G=async()=>{const r=(await v()).filter(t=>t.draft),s=document.querySelector(".content");r.forEach(t=>{const l=e(w,null,e("div",{"data-page-draft":"verified",class:"pt-8 pb-2"},e("a",{href:`/post/${t.id}`,class:"px-4 pb-4 flex justify-between items-center group"},e("div",{class:"flex flex-col"},e("h1",{class:"page-title w-[fit-content] text-lg transition-all font-semibold group-hover:underline"},t.title),e("p",{class:"text-text text-opacity-60 text-sm"},t.intro)),t.cover&&e("img",{class:"w-16 h-16 rounded object-cover",src:t.cover.src,alt:t.cover.alt})),e("div",{class:"flex pt-2 gap-2 px-4"},t.tags.map(o=>e("a",{href:`/tag/${encodeURIComponent(o)}`,class:"text-sm text-gray hover:text-black"},"#",o))),e("div",{"data-acc-time":t.createTime,class:"text-end text-xs text-gray"},A(t.createTime))),e("hr",null));s?.insertBefore(l,s.firstChild)})};U("#auth");
